<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PE - Nos produits</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="nosproduits-page">
    <div class="background--custom"></div>
    <!-- ===== HEADER ===== -->
    <div id="header"></div>
    <section class="nosproduits-maincontainer">
      <!-- ===== PRODUCTS BANNER ===== -->
      <div id="products-banner"></div>
    </section>
    <section class="pageproduits-container"></section>

    <div class="text-presentation-produits">
      <h1>MICROPHONES</h1>
    </div>

    <!-- Barre de recherche et filtres en dessous du header -->
    <div class="search-and-filters">
      <!-- Barre de recherche -->
      <input
        type="text"
        id="search-input"
        placeholder="Rechercher un produit..."
      />
      <!-- Filtres par catégorie -->
      <div id="filter-buttons">
        <button data-categorie="All">Tous</button>
      </div>
    </div>

    <div class="products-section">
      <div class="products-grid" id="products-container">
        <!-- Les produits seront générés ici par JS -->
      </div>
    </div>

    <!-- ===== Bouton Scroll To Top ===== -->
    <button id="scrollToTop"><i class="fas fa-arrow-up"></i></button>

    <div id="footer"></div>
    <!-- ===== SCRIPT JS ===== -->
    <script src="script.js"></script>
    <script src="header.js"></script>
    <script src="products-banner.js"></script>
    <script src="footer.js"></script>
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
    <script>
      let produits = [];

      const container = document.getElementById("products-container");
      const searchInput = document.getElementById("search-input");
      const filterButtons = document.querySelectorAll("#filter-buttons button");

      // Récupérer le paramètre search depuis l'URL
      const urlParams = new URLSearchParams(window.location.search);
      const searchParam = urlParams.get("search");

      // Fonction pour afficher les produits
      function displayProducts(list) {
        container.innerHTML = "";
        if (list.length === 0) {
          container.innerHTML = "<p>Aucun produit trouvé.</p>";
          return;
        }
        list.forEach((produit) => {
          const card = document.createElement("div");
          card.classList.add("product-card");
          card.innerHTML = `
            <img src="${produit.image}" alt="${produit.nom}">
            <h2>${produit.nom}</h2>
            ${produit.tag ? `<span class="tag">${produit.tag}</span>` : ""}
            <p>${produit.description}</p>
          `;
          container.appendChild(card);
        });
      }

      // Récupération des produits depuis le JSON
      fetch("microphones.json")
        .then((res) => res.json())
        .then((data) => {
          produits = data;

          // Si un paramètre search est présent dans l'URL, filtrer dès le départ
          if (searchParam) {
            const filtered = produits.filter((p) =>
              p.nom.toLowerCase().includes(searchParam.toLowerCase())
            );
            displayProducts(filtered);
            searchInput.value = searchParam;
          } else {
            displayProducts(produits);
          }
        });

      // Recherche en temps réel
      searchInput.addEventListener("input", () => {
        const searchValue = searchInput.value.toLowerCase();
        const filtered = produits.filter((p) =>
          p.nom.toLowerCase().includes(searchValue)
        );
        displayProducts(filtered);
      });

      // Gestion des filtres avec activation/désactivation
      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const isActive = btn.classList.contains("active");
          const cat = btn.dataset.categorie;

          // On enlève l'état actif de tous les boutons
          filterButtons.forEach((b) => b.classList.remove("active"));

          if (isActive) {
            // Si on reclique sur le même bouton → désactivation → tout afficher
            displayProducts(produits);
          } else {
            // Sinon on active le bouton cliqué
            btn.classList.add("active");

            if (cat === "All") {
              displayProducts(produits);
            } else {
              displayProducts(
                produits.filter((p) =>
                  Array.isArray(p.categorie)
                    ? p.categorie.includes(cat)
                    : p.categorie === cat
                )
              );
            }
          }
        });
      });

      // === Script du bouton Scroll To Top ===
      const btnScroll = document.getElementById("scrollToTop");
      window.addEventListener("scroll", () => {
        if (window.scrollY > 200) {
          btnScroll.style.display = "block";
        } else {
          btnScroll.style.display = "none";
        }
      });
      btnScroll.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    </script>
    <!-- <script src="footer.js"></script> -->
  </body>
</html>
